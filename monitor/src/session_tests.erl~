%%%-------------------------------------------------------------------
%%% @author adoor balasubramanian <balu@localhost.localdomain>
%%% @copyright (C) 2015, adoor balasubramanian
%%% @doc
%%%
%%% @end
%%% Created : 30 Jan 2015 by adoor balasubramanian <balu@localhost.localdomain>
%%%-------------------------------------------------------------------
-module(session_tests).

-import(session, [aw_response/2]).

-include_lib("eunit/include/eunit.hrl").
-include("../../common/common.hrl").


aw_response_retransmission_test() ->
    Msg = {state,
                             {80,45331,<<10,0,0,7>>,<<98,138,47,199>>},
                             sniffer,
                             {session,<<98,138,47,199>>,80,<<10,0,0,7>>},
                             {timeStamp,1422654072,629059},
                             327950,undefined,0,[],1524288631,1524288632,
                             {timeStamp,1422654075,36944},
                             [<<84,203,250,123,0,0,144,80,0,0,5,234,0,0,5,234,
                                132,27,94,239,126,228,248,15,65,181,238,126,8,
                                0,69,0,5,220,17,64,64,0,64,6,135,132,10,0,0,7,
                                98,138,47,199,177,19,0,80,90,218,204,120,121,
                                97,116,218,128,16,0,229,114,202,0,0,1,1,8,10,0,
                                140,230,178,3,251,133,147,71,69,84,32,47,121,
                                105,63,98,118,61,49,46,48,46,48,38,98,115,61,
                                40,49,51,54,114,113,101,116,51,101,40,103,105,
                                100,36,74,76,84,79,98,68,73,119,78,105,54,80,
                                100,79,117,103,86,76,107,54,65,103,71,55,78,84,
                                65,117,77,86,84,76,46,110,106,95,110,104,100,
                                73,44,115,116,36,49,52,50,50,54,53,52,48,55,51,
                                49,48,57,51,56,56,44,115,105,36,52,52,53,49,48,
                                53,49,44,115,112,36,49,49,56,51,51,48,48,48,48,
                                50,44,112,118,36,48,44,118,36,50,46,48,41,41,
                                38,116,61,74,95,51,45,68,95,51,38,97,108,61,40,
                                97,115,36,49,51,97,107,48,107,98,108,57,44,97,
                                105,100,36,57,97,50,102,89,109,75,76,99,48,99,
                                45,44,98,105,36,50,49,57,50,57,49,49,48,53,49,
                                44,97,103,112,36,51,51,53,55,49,52,54,53,53,49,
                                44,99,114,36,52,51,50,53,55,48,53,48,53,49,44,
                                99,116,36,50,53,44,97,116,36,72,44,101,111,98,
                                36,103,100,49,95,109,97,116,99,104,95,105,100,
                                61,45,49,58,121,112,111,115,61,66,84,78,41,40,
                                97,115,36,49,51,97,105,111,97,50,118,105,44,97,
                                105,100,36,121,115,71,102,89,109,75,76,99,48,
                                99,45,44,98,105,36,50,50,48,51,57,53,55,53,53,
                                49,44,97,103,112,36,51,51,55,50,52,53,48,48,53,
                                49,44,99,114,36,52,51,51,53,50,50,53,48,53,49,
                                44,99,116,36,50,53,44,97,116,36,72,44,101,111,
                                98,36,103,100,49,95,109,97,116,99,104,95,105,
                                100,61,45,49,58,121,112,111,115,61,66,84,78,41,
                                40,97,115,36,49,51,97,55,97,105,112,102,49,44,
                                97,105,100,36,110,57,87,102,89,109,75,76,99,48,
                                99,45,44,98,105,36,50,49,56,51,52,53,50,48,53,
                                49,44,97,103,112,36,51,51,52,50,52,50,49,53,53,
                                49,44,99,114,36,52,51,50,50,53,52,48,53,53,49,
                                44,99,116,36,50,53,44,97,116,36,72,44,101,111,
                                98,36,103,100,49,95,109,97,116,99,104,95,105,
                                100,61,45,49,58,121,112,111,115,61,66,84,78,41,
                                40,97,115,36,49,51,97,53,113,108,109,108,116,
                                44,97,105,100,36,100,79,109,102,89,109,75,76,
                                99,48,99,45,44,98,105,36,50,49,57,56,56,51,57,
                                53,53,49,44,97,103,112,36,51,51,54,49,49,53,55,
                                48,53,49,44,99,114,36,52,51,50,57,48,57,48,53,
                                53,49,44,99,116,36,50,53,44,97,116,36,72,44,
                                101,111,98,36,103,100,49,95,109,97,116,99,104,
                                95,105,100,61,45,49,58,121,112,111,115,61,66,
                                84,78,41,40,97,115,36,49,51,97,109,102,48,53,
                                103,49,44,97,105,100,36,72,104,71,103,89,109,
                                75,76,99,48,99,45,44,98,105,36,50,50,48,55,48,
                                53,56,48,53,49,44,97,103,112,36,51,51,55,55,49,
                                50,48,53,53,49,44,99,114,36,52,51,51,57,50,51,
                                52,48,53,49,44,99,116,36,50,53,44,97,116,36,72,
                                44,101,111,98,36,103,100,49,95,109,97,116,99,
                                104,95,105,100,61,45,49,58,121,112,111,115,61,
                                76,68,82,66,41,40,97,115,36,49,51,97,54,107,97,
                                111,50,116,44,97,105,100,36,56,121,83,103,89,
                                109,75,76,99,48,99,45,44,98,105,36,50,49,54,53,
                                50,49,49,48,53,49,44,97,103,112,36,51,51,48,48,
                                54,55,55,53,53,49,44,99,114,36,52,50,54,53,51,
                                57,48,53,53,49,44,99,116,36,50,53,44,97,116,36,
                                72,44,101,111,98,36,103,100,49,95,109,97,116,
                                99,104,95,105,100,61,45,49,58,121,112,111,115,
                                61,76,82,69,67,41,40,97,115,36,49,51,97,52,110,
                                56,109,118,52,44,97,105,100,36,121,68,105,103,
                                89,109,75,76,99,48,99,45,44,98,105,36,50,49,54,
                                53,50,49,48,53,53,49,44,97,103,112,36,51,51,48,
                                48,54,55,56,53,53,49,44,99,114,36,52,50,54,53,
                                51,57,49,48,53,49,44,99,116,36,50,53,44,97,116,
                                36,72,44,101,111,98,36,103,100,49,95,109,97,
                                116,99,104,95,105,100,61,45,49,58,121,112,111,
                                115,61,76,82,69,67,50,41,40,97,115,36,49,50,53,
                                99,111,49,57,98,50,44,97,105,100,36,110,85,121,
                                103,89,109,75,76,99,48,99,45,44,99,114,36,45,
                                49,44,99,116,36,50,53,44,97,116,36,72,44,101,
                                111,98,36,103,100,49,95,109,97,116,99,104,95,
                                105,100,61,45,49,58,121,112,111,115,61,77,65,
                                83,84,41,40,97,115,36,49,50,53,116,51,53,52,
                                112,57,44,97,105,100,36,83,102,50,102,89,109,
                                75,76,99,48,99,45,44,99,114,36,45,49,44,99,116,
                                36,50,53,44,97,116,36,72,44,101,111,98,36,103,
                                100,49,95,109,97,116,99,104,95,105,100,61,45,
                                49,58,121,112,111,115,61,70,83,82,86,89,41,40,
                                97,115,36,49,50,53,100,52,108,57,108,103,44,97,
                                105,100,36,99,109,67,103,89,109,75,76,99,48,99,
                                45,44,99,114,36,45,49,44,99,116,36,50,53,44,97,
                                116,36,72,44,101,111,98,36,103,100,49,95,109,
                                97,116,99,104,95,105,100,61,45,49,58,121,112,
                                111,115,61,87,80,70,80,41,38,115,61,48,38,114,
                                61,48,46,57,54,56,51,50,50,50,52,54,53,54,56,
                                50,55,55,53,32,72,84,84,80,47,49,46,49,13,10,
                                72,111,115,116,58,32,99,115,99,46,98,101,97,
                                112,46,98,99,46,121,97,104,111,111,46,99,111,
                                109,13,10,67,111,110,110,101,99,116,105,111,
                                110,58,32,107,101,101,112,45,97,108,105,118,
                                101,13,10,65,99,99,101,112,116,58,32,105,109,
                                97,103,101,47,119,101,98,112,44,42,47,42,59,
                                113,61,48,46,56,13,10,85,115,101,114,45,65,103,
                                101,110,116,58,32,77,111,122,105,108,108,97,47,
                                53,46,48,32,40,88,49,49,59,32,76,105,110,117,
                                120,32,120,56,54,95,54,52,41,32,65,112,112,108,
                                101,87,101,98,75,105,116,47,53,51,55,46,51,54,
                                32,40,75,72,84,77,76,44,32,108,105,107,101,32,
                                71,101,99,107,111,41,32,67,104,114,111,109,101,
                                47,51,56,46,48,46,50,49,50,53,46,49,49,49,32,
                                83,97,102,97,114,105,47,53,51,55,46,51,54,13,
                                10,82,101,102,101,114,101,114,58,32,104,116,
                                116,112,58,47,47,108,46,121,105,109,103,46,99,
                                111,109>>,
                              <<84,203,250,122,0,3,85,48,0,0,0,66,0,0,0,66,132,
                                27,94,239,126,228,248,15,65,181,238,126,8,0,69,
                                0,0,52,17,63,64,0,64,6,141,45,10,0,0,7,98,138,
                                47,199,177,19,0,80,90,218,204,120,121,97,116,
                                218,128,16,0,229,164,243,0,0,1,1,8,10,0,140,
                                227,127,3,251,133,147>>,
                              <<84,203,250,122,0,3,84,222,0,0,0,74,0,0,0,74,
                                248,15,65,181,238,126,132,27,94,239,126,228,8,
                                0,69,32,0,60,0,0,64,0,49,6,173,68,98,138,47,
                                199,10,0,0,7,0,80,177,19,121,97,116,217,90,218,
                                204,120,160,18,56,144,62,101,0,0,2,4,5,180,4,2,
                                8,10,3,251,138,151,0,140,222,146,1,3,3,7>>,
                              <<84,203,250,120,0,14,154,138,0,0,0,66,0,0,0,66,
                                132,27,94,239,126,228,248,15,65,181,238,126,8,
                                0,69,0,0,52,17,62,64,0,64,6,141,46,10,0,0,7,98,
                                138,47,199,177,19,0,80,90,218,204,120,121,97,
                                116,218,128,16,0,229,169,224,0,0,1,1,8,10,0,
                                140,222,146,3,251,133,147>>,
                              <<84,203,250,120,0,14,154,81,0,0,0,74,0,0,0,74,
                                248,15,65,181,238,126,132,27,94,239,126,228,8,
                                0,69,32,0,60,0,0,64,0,48,6,174,68,98,138,47,
                                199,10,0,0,7,0,80,177,19,121,97,116,217,90,218,
                                204,120,160,18,56,144,68,177,0,0,2,4,5,180,4,2,
                                8,10,3,251,133,147,0,140,221,74,1,3,3,7>>,
                              <<84,203,250,120,0,9,153,67,0,0,0,74,0,0,0,74,
                                132,27,94,239,126,228,248,15,65,181,238,126,8,
                                0,69,0,0,60,17,61,64,0,64,6,141,39,10,0,0,7,
                                98,138,47,199,177,19,0,80,90,218,204,119,0,0,
                                0,0,160,2,114,16,131,11,0,0,2,4,5,180,4,2,8,
                                10,0,140,221,74,0,0,0,0,1,3,3,7>>],
	   []},
    State = {state,{80,45331,<<10,0,0,7>>,<<98,138,47,199>>},
       sniffer,
       {session,<<98,138,47,199>>,80,<<10,0,0,7>>},
       {timeStamp,1422654072,629059},
       327950,undefined,0,[],1524288631,1524288632,
       {timeStamp,1422654075,36944},
       [<<84,203,250,123,0,0,144,80,0,0,5,234,0,0,5,234,132,27,94,239,126,228,
          248,15,65,181,238,126,8,0,69,0,5,220,17,64,64,0,64,6,135,132,10,0,0,
          7,98,138,47,199,177,19,0,80,90,218,204,120,121,97,116,218,128,16,0,
          229,114,202,0,0,1,1,8,10,0,140,230,178,3,251,133,147,71,69,84,32,47,
          121,105,63,98,118,61,49,46,48,46,48,38,98,115,61,40,49,51,54,114,113,
          101,116,51,101,40,103,105,100,36,74,76,84,79,98,68,73,119,78,105,54,
          80,100,79,117,103,86,76,107,54,65,103,71,55,78,84,65,117,77,86,84,76,
          46,110,106,95,110,104,100,73,44,115,116,36,49,52,50,50,54,53,52,48,
          55,51,49,48,57,51,56,56,44,115,105,36,52,52,53,49,48,53,49,44,115,
          112,36,49,49,56,51,51,48,48,48,48,50,44,112,118,36,48,44,118,36,50,
          46,48,41,41,38,116,61,74,95,51,45,68,95,51,38,97,108,61,40,97,115,36,
          49,51,97,107,48,107,98,108,57,44,97,105,100,36,57,97,50,102,89,109,
          75,76,99,48,99,45,44,98,105,36,50,49,57,50,57,49,49,48,53,49,44,97,
          103,112,36,51,51,53,55,49,52,54,53,53,49,44,99,114,36,52,51,50,53,55,
          48,53,48,53,49,44,99,116,36,50,53,44,97,116,36,72,44,101,111,98,36,
          103,100,49,95,109,97,116,99,104,95,105,100,61,45,49,58,121,112,111,
          115,61,66,84,78,41,40,97,115,36,49,51,97,105,111,97,50,118,105,44,97,
          105,100,36,121,115,71,102,89,109,75,76,99,48,99,45,44,98,105,36,50,
          50,48,51,57,53,55,53,53,49,44,97,103,112,36,51,51,55,50,52,53,48,48,
          53,49,44,99,114,36,52,51,51,53,50,50,53,48,53,49,44,99,116,36,50,53,
          44,97,116,36,72,44,101,111,98,36,103,100,49,95,109,97,116,99,104,95,
          105,100,61,45,49,58,121,112,111,115,61,66,84,78,41,40,97,115,36,49,
          51,97,55,97,105,112,102,49,44,97,105,100,36,110,57,87,102,89,109,75,
          76,99,48,99,45,44,98,105,36,50,49,56,51,52,53,50,48,53,49,44,97,103,
          112,36,51,51,52,50,52,50,49,53,53,49,44,99,114,36,52,51,50,50,53,52,
          48,53,53,49,44,99,116,36,50,53,44,97,116,36,72,44,101,111,98,36,103,
          100,49,95,109,97,116,99,104,95,105,100,61,45,49,58,121,112,111,115,
          61,66,84,78,41,40,97,115,36,49,51,97,53,113,108,109,108,116,44,97,
          105,100,36,100,79,109,102,89,109,75,76,99,48,99,45,44,98,105,36,50,
          49,57,56,56,51,57,53,53,49,44,97,103,112,36,51,51,54,49,49,53,55,48,
          53,49,44,99,114,36,52,51,50,57,48,57,48,53,53,49,44,99,116,36,50,53,
          44,97,116,36,72,44,101,111,98,36,103,100,49,95,109,97,116,99,104,95,
          105,100,61,45,49,58,121,112,111,115,61,66,84,78,41,40,97,115,36,49,
          51,97,109,102,48,53,103,49,44,97,105,100,36,72,104,71,103,89,109,75,
          76,99,48,99,45,44,98,105,36,50,50,48,55,48,53,56,48,53,49,44,97,103,
          112,36,51,51,55,55,49,50,48,53,53,49,44,99,114,36,52,51,51,57,50,51,
          52,48,53,49,44,99,116,36,50,53,44,97,116,36,72,44,101,111,98,36,103,
          100,49,95,109,97,116,99,104,95,105,100,61,45,49,58,121,112,111,115,
          61,76,68,82,66,41,40,97,115,36,49,51,97,54,107,97,111,50,116,44,97,
          105,100,36,56,121,83,103,89,109,75,76,99,48,99,45,44,98,105,36,50,49,
          54,53,50,49,49,48,53,49,44,97,103,112,36,51,51,48,48,54,55,55,53,53,
          49,44,99,114,36,52,50,54,53,51,57,48,53,53,49,44,99,116,36,50,53,44,
          97,116,36,72,44,101,111,98,36,103,100,49,95,109,97,116,99,104,95,105,
          100,61,45,49,58,121,112,111,115,61,76,82,69,67,41,40,97,115,36,49,51,
          97,52,110,56,109,118,52,44,97,105,100,36,121,68,105,103,89,109,75,76,
          99,48,99,45,44,98,105,36,50,49,54,53,50,49,48,53,53,49,44,97,103,112,
          36,51,51,48,48,54,55,56,53,53,49,44,99,114,36,52,50,54,53,51,57,49,
          48,53,49,44,99,116,36,50,53,44,97,116,36,72,44,101,111,98,36,103,100,
          49,95,109,97,116,99,104,95,105,100,61,45,49,58,121,112,111,115,61,76,
          82,69,67,50,41,40,97,115,36,49,50,53,99,111,49,57,98,50,44,97,105,
          100,36,110,85,121,103,89,109,75,76,99,48,99,45,44,99,114,36,45,49,44,
          99,116,36,50,53,44,97,116,36,72,44,101,111,98,36,103,100,49,95,109,
          97,116,99,104,95,105,100,61,45,49,58,121,112,111,115,61,77,65,83,84,
          41,40,97,115,36,49,50,53,116,51,53,52,112,57,44,97,105,100,36,83,102,
          50,102,89,109,75,76,99,48,99,45,44,99,114,36,45,49,44,99,116,36,50,
          53,44,97,116,36,72,44,101,111,98,36,103,100,49,95,109,97,116,99,104,
          95,105,100,61,45,49,58,121,112,111,115,61,70,83,82,86,89,41,40,97,
          115,36,49,50,53,100,52,108,57,108,103,44,97,105,100,36,99,109,67,103,
          89,109,75,76,99,48,99,45,44,99,114,36,45,49,44,99,116,36,50,53,44,97,
          116,36,72,44,101,111,98,36,103,100,49,95,109,97,116,99,104,95,105,
          100,61,45,49,58,121,112,111,115,61,87,80,70,80,41,38,115,61,48,38,
          114,61,48,46,57,54,56,51,50,50,50,52,54,53,54,56,50,55,55,53,32,72,
          84,84,80,47,49,46,49,13,10,72,111,115,116,58,32,99,115,99,46,98,101,
          97,112,46,98,99,46,121,97,104,111,111,46,99,111,109,13,10,67,111,110,
          110,101,99,116,105,111,110,58,32,107,101,101,112,45,97,108,105,118,
          101,13,10,65,99,99,101,112,116,58,32,105,109,97,103,101,47,119,101,
          98,112,44,42,47,42,59,113,61,48,46,56,13,10,85,115,101,114,45,65,103,
          101,110,116,58,32,77,111,122,105,108,108,97,47,53,46,48,32,40,88,49,
          49,59,32,76,105,110,117,120,32,120,56,54,95,54,52,41,32,65,112,112,
          108,101,87,101,98,75,105,116,47,53,51,55,46,51,54,32,40,75,72,84,77,
          76,44,32,108,105,107,101,32,71,101,99,107,111,41,32,67,104,114,111,
          109,101,47,51,56,46,48,46,50,49,50,53,46,49,49,49,32,83,97,102,97,
          114,105,47,53,51,55,46,51,54,13,10,82,101,102,101,114,101,114,58,32,
          104,116,116,112,58,47,47,108,46,121,105,109,103,46,99,111,109>>,
        <<84,203,250,122,0,3,85,48,0,0,0,66,0,0,0,66,132,27,94,239,126,228,248,
          15,65,181,238,126,8,0,69,0,0,52,17,63,64,0,64,6,141,45,10,0,0,7,98,
          138,47,199,177,19,0,80,90,218,204,120,121,97,116,218,128,16,0,229,
          164,243,0,0,1,1,8,10,0,140,227,127,3,251,133,147>>,
        <<84,203,250,122,0,3,84,222,0,0,0,74,0,0,0,74,248,15,65,181,238,126,
          132,27,94,239,126,228,8,0,69,32,0,60,0,0,64,0,49,6,173,68,98,138,47,
          199,10,0,0,7,0,80,177,19,121,97,116,217,90,218,204,120,160,18,56,144,
          62,101,0,0,2,4,5,180,4,2,8,10,3,251,138,151,0,140,222,146,1,3,3,7>>,
        <<84,203,250,120,0,14,154,138,0,0,0,66,0,0,0,66,132,27,94,239,126,228,
          248,15,65,181,238,126,8,0,69,0,0,52,17,62,64,0,64,6,141,46,10,0,0,7,
          98,138,47,199,177,19,0,80,90,218,204,120,121,97,116,218,128,16,0,229,
          169,224,0,0,1,1,8,10,0,140,222,146,3,251,133,147>>,
        <<84,203,250,120,0,14,154,81,0,0,0,74,0,0,0,74,248,15,65,181,238,126,
          132,27,94,239,126,228,8,0,69,32,0,60,0,0,64,0,48,6,174,68,98,138,47,
          199,10,0,0,7,0,80,177,19,121,97,116,217,90,218,204,120,160,18,56,144,
          68,177,0,0,2,4,5,180,4,2,8,10,3,251,133,147,0,140,221,74,1,3,3,7>>,
        <<84,203,250,120,0,9,153,67,0,0,0,74,0,0,0,74,132,27,94,239,126,228,
          248,15,65,181,238,126,8,0,69,0,0,60,17,61,64,0,64,6,141,39,10,0,0,7,
          98,138,47,199,177,19,0,80,90,218,204,119,0,0,0,0,160,2,114,16,131,
          11,0,0,2,4,5,180,4,2,8,10,0,140,221,74,0,0,0,0,1,3,3,7>>],
	     []},
    
    aw_response(Msg, State).
